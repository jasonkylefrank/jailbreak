import { signOut } from "firebase/auth";
import { doc, getDoc, setDoc, collection, getDocs } from 'firebase/firestore';
import { auth, firestore } from "../lib/firebase";
import LogInButton from "./LogInButton";
import styled from "styled-components";
import Button from '@mui/material/Button';
import { useContext, useEffect } from "react";
import { UserAuthContext } from "../lib/context";
import { firebaseProjectId } from "../lib/firebase";

const Page = styled.div`
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  flex: 1;
`;

export default function WelcomeLogIn() {
  const { userAuth } = useContext(UserAuthContext);

  // Handle user log in event
  useEffect(() => {

    if (userAuth) {
      
      try { 
        ( async () => {
          const userDocRef = doc(firestore, 'users', userAuth.uid);
          const userDocSnap = await getDoc(userDocRef);
          
          // Add a new user doc if this user doesn't have one yet
          if (!userDocSnap.exists()) {
            const { uid, displayName, email, photoURL } = userAuth;
  
            await setDoc(userDocRef, {
              uid,
              displayName,
              email,
              photoURL
            });
          }
        })();       
      } catch (error) {
        console.error(error);
      }
    }
      
  }, [userAuth]);

  // TEMP ---------
  useEffect(() => {
    ( async () => {
        if (userAuth) {
          try {
            const docsSnapshot = await getDocs(collection(firestore, 'users'));
        
            docsSnapshot.forEach(doc => console.log(doc.data()));          
          } catch (error) {
            console.log(error);
          }          
        } else {
          console.log('User not logged in, so I\'m not trying to read from the database');
        }
    })();    
  }, [userAuth]);
  
  

  return (
    <Page>
      {
        userAuth 
          ?
            <>
              <p>Welcome, {userAuth.displayName}!</p>
              <LogOutButton />
            </>          
          : <LogInButton />
      }

      <p>Current Firebase project ID: {firebaseProjectId}</p>
    </Page>
  );
}


function LogOutButton() {
  return (
    <Button onClick={() => signOut(auth)}>Log out</Button>
  );
}





// The entire "Google" logo
function GoogleLogoSVG() {
  return (
    <svg>
      <g  transform="matrix(1,0,0,1,45.75,7.75)" 
          opacity="0.9999994330853343"
      >
        <g opacity="1" 
          transform="matrix(1,0,0,1,9.361000061035156,9.559000015258789)"
        >
          <path fill="rgb(95,99,104)" 
            fillOpacity="1" 
            d=" M0.37599998712539673,9.309000015258789 C-4.7769999504089355,9.309000015258789 
                -9.111000061035156,5.131999969482422 -9.111000061035156,
                0 C-9.111000061035156,-5.13100004196167 -4.7769999504089355,
                -9.309000015258789 0.37599998712539673,-9.309000015258789 C3.2279999256134033,
                -9.309000015258789 5.256999969482422,-8.196000099182129 6.785999774932861,
                -6.743000030517578 C6.785999774932861,-6.743000030517578 4.98199987411499,
                -4.949999809265137 4.98199987411499,-4.949999809265137 C3.888000011444092,
                -5.9710001945495605 2.4059998989105225,-6.765999794006348 0.37599998712539673,
                -6.765999794006348 C-3.38700008392334,-6.765999794006348 -6.328999996185303,
                -3.746000051498413 -6.328999996185303,0 C-6.328999996185303,3.746999979019165 
                -3.38700008392334,6.767000198364258 0.37599998712539673,6.767000198364258 
                C2.815999984741211,6.767000198364258 4.208000183105469,5.789999961853027 
                5.0980000495910645,4.90500020980835 C5.827000141143799,4.177999973297119 6.307000160217285,
                3.134000062942505 6.48799991607666,1.7029999494552612 C6.48799991607666,1.7029999494552612 
                0.37599998712539673,1.7029999494552612 0.37599998712539673,1.7029999494552612 
                C0.37599998712539673,1.7029999494552612 0.37599998712539673,-0.8399999737739563 
                0.37599998712539673,-0.8399999737739563 C0.37599998712539673,-0.8399999737739563 
                8.975000381469727,-0.8399999737739563 8.975000381469727,-0.8399999737739563 
                C9.065999984741211,-0.38600000739097595 9.111000061035156,0.1599999964237213 
                9.111000061035156,0.75 C9.111000061035156,2.6570000648498535 8.586000442504883,
                5.01800012588501 6.8979997634887695,6.698999881744385 C5.25600004196167,8.401000022888184
                 3.1589999198913574,9.309000015258789 0.37599998712539673,9.309000015258789z"
          >
          </path>
        </g>
        <g opacity="1" 
          transform="matrix(1,0,0,1,25.83799934387207,12.87399959564209)"
        >
        <path fill="rgb(95,99,104)" 
          fillOpacity="1" 
          d=" M5.934999942779541,0 C5.934999942779541,3.4509999752044678 3.2690000534057617,5.99399995803833 
            -0.0010000000474974513,5.99399995803833 C-3.2699999809265137,5.99399995803833 -5.934999942779541,
            3.4509999752044678 -5.934999942779541,0 C-5.934999942779541,-3.4739999771118164 -3.2699999809265137,
            -5.99399995803833 -0.0010000000474974513,-5.99399995803833 C3.2690000534057617,-5.99399995803833 
            5.934999942779541,-3.4739999771118164 5.934999942779541,0z M3.3369998931884766,0 C3.3369998931884766,
            -2.1570000648498535 1.7899999618530273,-3.632999897003174 -0.0010000000474974513,-3.632999897003174 
            C-1.7920000553131104,-3.632999897003174 -3.3380000591278076,-2.1570000648498535 -3.3380000591278076,
            0 C-3.3380000591278076,2.134000062942505 -1.7920000553131104,3.632999897003174 
            -0.0010000000474974513,3.632999897003174 C1.7899999618530273,3.632999897003174 3.3369998931884766,
            2.134000062942505 3.3369998931884766,0z"
          >
          </path>
        </g>
        <g opacity="1" 
          transform="matrix(1,0,0,1,39.14099884033203,12.87399959564209)"
        >
        <path fill="rgb(95,99,104)" 
          fillOpacity="1" 
          d=" M5.934999942779541,0 C5.934999942779541,3.4509999752044678 3.2690000534057617,5.99399995803833 
            -0.0010000000474974513,5.99399995803833 C-3.2690000534057617,5.99399995803833 -5.934999942779541,
            3.4509999752044678 -5.934999942779541,0 C-5.934999942779541,-3.4739999771118164 -3.2690000534057617,
            -5.99399995803833 -0.0010000000474974513,-5.99399995803833 C3.2690000534057617,-5.99399995803833 
            5.934999942779541,-3.4739999771118164 5.934999942779541,0z M3.3369998931884766,0 C3.3369998931884766,
            -2.1570000648498535 1.7910000085830688,-3.632999897003174 -0.0010000000474974513,-3.632999897003174 
            C-1.7920000553131104,-3.632999897003174 -3.3369998931884766,-2.1570000648498535 -3.3369998931884766,0 
            C-3.3369998931884766,2.134000062942505 -1.7920000553131104,3.632999897003174 -0.0010000000474974513,
            3.632999897003174 C1.7910000085830688,3.632999897003174 3.3369998931884766,2.134000062942505 
            3.3369998931884766,0z"
          >
          </path>
        </g>
        <g opacity="1" 
          transform="matrix(1,0,0,1,52.275001525878906,15.5649995803833)"
        >
          <path fill="rgb(95,99,104)" 
            fillOpacity="1" 
            d=" M5.769999980926514,-8.321999549865723 C5.769999980926514,-8.321999549865723 5.769999980926514,
              2.440999984741211 5.769999980926514,2.440999984741211 C5.769999980926514,6.86899995803833 
              3.1480000019073486,8.6850004196167 0.04600000008940697,8.6850004196167 C-2.872999906539917,
              8.6850004196167 -4.629000186920166,6.73199987411499 -5.289999961853027,5.14300012588501 
              C-5.289999961853027,5.14300012588501 -2.98799991607666,4.189000129699707 -2.98799991607666,
              4.189000129699707 C-2.5769999027252197,5.164999961853027 -1.5740000009536743,6.322999954223633 
              0.04600000008940697,6.322999954223633 C2.0299999713897705,6.322999954223633 3.26200008392334,
              5.0980000495910645 3.26200008392334,2.803999900817871 C3.26200008392334,2.803999900817871 3.26200008392334,
              1.940999984741211 3.26200008392334,1.940999984741211 C3.26200008392334,1.940999984741211 3.1710000038146973,
              1.940999984741211 3.1710000038146973,1.940999984741211 C2.578000068664551,2.6679999828338623 1.437000036239624,
              3.302999973297119 0.0010000000474974513,3.302999973297119 C-3.009999990463257,3.302999973297119 
              -5.769999980926514,0.6930000185966492 -5.769999980926514,-2.6679999828338623 C-5.769999980926514,
              -6.051000118255615 -3.009999990463257,-8.6850004196167 0.0010000000474974513,-8.6850004196167 
              C1.437000036239624,-8.6850004196167 2.578000068664551,-8.048999786376953 3.1710000038146973,
              -7.34499979019165 C3.1710000038146973,-7.34499979019165 3.26200008392334,-7.34499979019165 3.26200008392334,
              -7.34499979019165 C3.26200008392334,-7.34499979019165 3.26200008392334,-8.321999549865723 3.26200008392334,
              -8.321999549865723 C3.26200008392334,-8.321999549865723 5.769999980926514,-8.321999549865723 
              5.769999980926514,-8.321999549865723z M3.444000005722046,-2.6679999828338623 C3.444000005722046,
              -4.7789998054504395 2.0299999713897705,-6.323999881744385 0.2290000021457672,-6.323999881744385 
              C-1.5959999561309814,-6.323999881744385 -3.124000072479248,-4.7789998054504395 -3.124000072479248,
              -2.6679999828338623 C-3.124000072479248,-0.5789999961853027 -1.5959999561309814,0.9419999718666077 
              0.2290000021457672,0.9419999718666077 C2.0299999713897705,0.9419999718666077 3.444000005722046,
              -0.5789999961853027 3.444000005722046,-2.6679999828338623z"
            >              
            </path>
          </g>
          <g opacity="1" 
            transform="matrix(1,0,0,1,61.36000061035156,9.694999694824219)"
          >
            <path fill="rgb(95,99,104)" 
              fillOpacity="1" 
              d=" M1.3229999542236328,8.809000015258789 C1.3229999542236328,8.809000015258789 -1.3229999542236328,
                8.809000015258789 -1.3229999542236328,8.809000015258789 C-1.3229999542236328,8.809000015258789 
                -1.3229999542236328,-8.809000015258789 -1.3229999542236328,-8.809000015258789 C-1.3229999542236328,
                -8.809000015258789 1.3229999542236328,-8.809000015258789 1.3229999542236328,-8.809000015258789 
                C1.3229999542236328,-8.809000015258789 1.3229999542236328,8.809000015258789 1.3229999542236328,
                8.809000015258789z"
            >              
            </path>
          </g>
          <g opacity="1" 
            transform="matrix(1,0,0,1,69.73799896240234,12.87399959564209)"
          >
            <path fill="rgb(95,99,104)" 
              fillOpacity="1" 
              d=" M3.3440001010894775,1.975000023841858 C3.3440001010894775,1.975000023841858 5.396999835968018,
                3.3369998931884766 5.396999835968018,3.3369998931884766 C4.736999988555908,4.314000129699707 
                3.1389999389648438,5.993000030517578 0.3799999952316284,5.993000030517578 C-3.0399999618530273,
                5.993000030517578 -5.511000156402588,3.3610000610351562 -5.511000156402588,0.0010000000474974513 
                C-5.511000156402588,-3.563999891281128 -3.0190000534057617,-5.993000030517578 0.08399999886751175,
                -5.993000030517578 C3.2090001106262207,-5.993000030517578 4.736999988555908,-3.5190000534057617 
                5.23799991607666,-2.180000066757202 C5.23799991607666,-2.180000066757202 5.511000156402588,
                -1.4989999532699585 5.511000156402588,-1.4989999532699585 C5.511000156402588,-1.4989999532699585
                 -2.5390000343322754,1.815999984741211 -2.5390000343322754,1.815999984741211 C-1.9229999780654907,
                 3.0190000534057617 -0.9660000205039978,3.632999897003174 0.3799999952316284,3.632999897003174 
                 C1.725000023841858,3.632999897003174 2.6610000133514404,2.9739999771118164 3.3440001010894775,
                 1.975000023841858z M-2.9730000495910645,-0.18199999630451202 C-2.9730000495910645,-0.18199999630451202 
                 2.4100000858306885,-2.4059998989105225 2.4100000858306885,-2.4059998989105225 C2.11299991607666,
                 -3.1549999713897705 1.2239999771118164,-3.677999973297119 0.17399999499320984,-3.677999973297119 
                 C-1.1710000038146973,-3.677999973297119 -3.0399999618530273,-2.497999906539917 -2.9730000495910645,
                 -0.18199999630451202z"
              >                
              </path>
            </g>
          </g>
    </svg>
  );
}
